/// 検索機能のユーティリティ関数群

/// 検索用の文字列正規化関数
String normalizeSearchText(String text) {
  return text
      .toLowerCase()
      // ひらがなをカタカナに変換
      .replaceAll('あ', 'ア')
      .replaceAll('い', 'イ')
      .replaceAll('う', 'ウ')
      .replaceAll('え', 'エ')
      .replaceAll('お', 'オ')
      .replaceAll('か', 'カ')
      .replaceAll('き', 'キ')
      .replaceAll('く', 'ク')
      .replaceAll('け', 'ケ')
      .replaceAll('こ', 'コ')
      .replaceAll('さ', 'サ')
      .replaceAll('し', 'シ')
      .replaceAll('す', 'ス')
      .replaceAll('せ', 'セ')
      .replaceAll('そ', 'ソ')
      .replaceAll('た', 'タ')
      .replaceAll('ち', 'チ')
      .replaceAll('つ', 'ツ')
      .replaceAll('て', 'テ')
      .replaceAll('と', 'ト')
      .replaceAll('な', 'ナ')
      .replaceAll('に', 'ニ')
      .replaceAll('ぬ', 'ヌ')
      .replaceAll('ね', 'ネ')
      .replaceAll('の', 'ノ')
      .replaceAll('は', 'ハ')
      .replaceAll('ひ', 'ヒ')
      .replaceAll('ふ', 'フ')
      .replaceAll('へ', 'ヘ')
      .replaceAll('ほ', 'ホ')
      .replaceAll('ま', 'マ')
      .replaceAll('み', 'ミ')
      .replaceAll('む', 'ム')
      .replaceAll('め', 'メ')
      .replaceAll('も', 'モ')
      .replaceAll('や', 'ヤ')
      .replaceAll('ゆ', 'ユ')
      .replaceAll('よ', 'ヨ')
      .replaceAll('ら', 'ラ')
      .replaceAll('り', 'リ')
      .replaceAll('る', 'ル')
      .replaceAll('れ', 'レ')
      .replaceAll('ろ', 'ロ')
      .replaceAll('わ', 'ワ')
      .replaceAll('を', 'ヲ')
      .replaceAll('ん', 'ン')
      // カタカナをひらがなに変換（逆方向）
      .replaceAll('ア', 'あ')
      .replaceAll('イ', 'い')
      .replaceAll('ウ', 'う')
      .replaceAll('エ', 'え')
      .replaceAll('オ', 'お')
      .replaceAll('カ', 'か')
      .replaceAll('キ', 'き')
      .replaceAll('ク', 'く')
      .replaceAll('ケ', 'け')
      .replaceAll('コ', 'こ')
      .replaceAll('サ', 'さ')
      .replaceAll('シ', 'し')
      .replaceAll('ス', 'す')
      .replaceAll('セ', 'せ')
      .replaceAll('ソ', 'そ')
      .replaceAll('タ', 'た')
      .replaceAll('チ', 'ち')
      .replaceAll('ツ', 'つ')
      .replaceAll('テ', 'て')
      .replaceAll('ト', 'と')
      .replaceAll('ナ', 'な')
      .replaceAll('ニ', 'に')
      .replaceAll('ヌ', 'ぬ')
      .replaceAll('ネ', 'ね')
      .replaceAll('ノ', 'の')
      .replaceAll('ハ', 'は')
      .replaceAll('ヒ', 'ひ')
      .replaceAll('フ', 'ふ')
      .replaceAll('ヘ', 'へ')
      .replaceAll('ホ', 'ほ')
      .replaceAll('マ', 'ま')
      .replaceAll('ミ', 'み')
      .replaceAll('ム', 'む')
      .replaceAll('メ', 'め')
      .replaceAll('モ', 'も')
      .replaceAll('ヤ', 'や')
      .replaceAll('ユ', 'ゆ')
      .replaceAll('ヨ', 'よ')
      .replaceAll('ラ', 'ら')
      .replaceAll('リ', 'り')
      .replaceAll('ル', 'る')
      .replaceAll('レ', 'れ')
      .replaceAll('ロ', 'ろ')
      .replaceAll('ワ', 'わ')
      .replaceAll('ヲ', 'を')
      .replaceAll('ン', 'ん')
      // 濁点・半濁点の正規化
      .replaceAll('が', 'か')
      .replaceAll('ぎ', 'き')
      .replaceAll('ぐ', 'く')
      .replaceAll('げ', 'け')
      .replaceAll('ご', 'こ')
      .replaceAll('ざ', 'さ')
      .replaceAll('じ', 'し')
      .replaceAll('ず', 'す')
      .replaceAll('ぜ', 'せ')
      .replaceAll('ぞ', 'そ')
      .replaceAll('だ', 'た')
      .replaceAll('ぢ', 'ち')
      .replaceAll('づ', 'つ')
      .replaceAll('で', 'て')
      .replaceAll('ど', 'と')
      .replaceAll('ば', 'は')
      .replaceAll('び', 'ひ')
      .replaceAll('ぶ', 'ふ')
      .replaceAll('べ', 'へ')
      .replaceAll('ぼ', 'ほ')
      .replaceAll('ぱ', 'は')
      .replaceAll('ぴ', 'ひ')
      .replaceAll('ぷ', 'ふ')
      .replaceAll('ぺ', 'へ')
      .replaceAll('ぽ', 'ほ')
      // カタカナの濁点・半濁点も正規化
      .replaceAll('ガ', 'か')
      .replaceAll('ギ', 'き')
      .replaceAll('グ', 'く')
      .replaceAll('ゲ', 'け')
      .replaceAll('ゴ', 'こ')
      .replaceAll('ザ', 'さ')
      .replaceAll('ジ', 'し')
      .replaceAll('ズ', 'す')
      .replaceAll('ゼ', 'せ')
      .replaceAll('ゾ', 'そ')
      .replaceAll('ダ', 'た')
      .replaceAll('ヂ', 'ち')
      .replaceAll('ヅ', 'つ')
      .replaceAll('デ', 'て')
      .replaceAll('ド', 'と')
      .replaceAll('バ', 'は')
      .replaceAll('ビ', 'ひ')
      .replaceAll('ブ', 'ふ')
      .replaceAll('ベ', 'へ')
      .replaceAll('ボ', 'ほ')
      .replaceAll('パ', 'は')
      .replaceAll('ピ', 'ひ')
      .replaceAll('プ', 'ふ')
      .replaceAll('ペ', 'へ')
      .replaceAll('ポ', 'ほ')
      // 英数字の正規化
      .replaceAll('ａ', 'a')
      .replaceAll('ｂ', 'b')
      .replaceAll('ｃ', 'c')
      .replaceAll('ｄ', 'd')
      .replaceAll('ｅ', 'e')
      .replaceAll('ｆ', 'f')
      .replaceAll('ｇ', 'g')
      .replaceAll('ｈ', 'h')
      .replaceAll('ｉ', 'i')
      .replaceAll('ｊ', 'j')
      .replaceAll('ｋ', 'k')
      .replaceAll('ｌ', 'l')
      .replaceAll('ｍ', 'm')
      .replaceAll('ｎ', 'n')
      .replaceAll('ｏ', 'o')
      .replaceAll('ｐ', 'p')
      .replaceAll('ｑ', 'q')
      .replaceAll('ｒ', 'r')
      .replaceAll('ｓ', 's')
      .replaceAll('ｔ', 't')
      .replaceAll('ｕ', 'u')
      .replaceAll('ｖ', 'v')
      .replaceAll('ｗ', 'w')
      .replaceAll('ｘ', 'x')
      .replaceAll('ｙ', 'y')
      .replaceAll('ｚ', 'z')
      .replaceAll('０', '0')
      .replaceAll('１', '1')
      .replaceAll('２', '2')
      .replaceAll('３', '3')
      .replaceAll('４', '4')
      .replaceAll('５', '5')
      .replaceAll('６', '6')
      .replaceAll('７', '7')
      .replaceAll('８', '8')
      .replaceAll('９', '9');
}

/// 検索マッチング関数
bool isSearchMatch(String searchQuery, String targetText) {
  if (searchQuery.isEmpty) return true;

  final normalizedQuery = normalizeSearchText(searchQuery);
  final normalizedTarget = normalizeSearchText(targetText);

  // 部分一致検索
  return normalizedTarget.contains(normalizedQuery);
}
